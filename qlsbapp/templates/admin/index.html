{% extends 'admin/base.html' %}

{% block body %}
{% if current_user.is_authenticated %}
    <div class="container mt-5">
        <h3>Thống kê doanh thu</h3>
        <div class="row mb-3">
            <div class="col-sm-3">
                <label for="thoigianthongke">Chọn thời gian:</label>
                <select id="thoigianthongke" name="thoigianthongke">
                    <option value="day">Theo ngày</option>
                    <option value="week">Theo tuần</option>
                    <option value="month">Theo tháng</option>
                    <option value="year">Theo năm</option>
                </select>
            </div>
            <div class="col-sm-4">
                <label for="san_bong">Chọn sân bóng:</label>
                <select id="san_bong" name="san_bong">
                    <option value="all">Tất cả sân bóng</option>
                    {% for s in sanbongs %}
                    <option value="{{ s.id }}">{{ s.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-sm-2 align-self-end">
                <button id="btn-thongke" class="btn btn-primary">Thống kê</button>
            </div>
        </div>
        <div id="thongke-result">
            <!-- Kết quả thống kê sẽ được hiển thị tại đây -->
        </div>
    </div>
{% else %}
<h1 class="text-center text-danger">Đăng nhập quản trị</h1>
<form method="post" action="{{ url_for('admin_signin') }}">
    <div class="form-group">
        <label for="username">Tài khoản</label>
        <input type="text" class="form-control" id="username" name="username" required>
    </div>
    <div class="form-group">
        <label for="pass">Mật khẩu</label>
        <input type="password" class="form-control" id="pass" name="password">
    </div>
    <input type="submit" value="Đăng nhập" class="btn btn-danger">
</form>
{% endif %}
<script>
document.getElementById('btn-thongke').addEventListener('click', function() {
    const thoigianthongke = document.getElementById('thoigianthongke').value;
    const san_bong = document.getElementById('san_bong').value;

    fetch('/admin/thongke', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            thoigianthongke: thoigianthongke,
            san_bong: san_bong
        })
    })
    .then(response => response.json())
    .then(data => {
        const resultDiv = document.getElementById('thongke-result');
        resultDiv.innerHTML = `<div class="alert alert-info">Tổng doanh thu: ${data.total_revenue} VND</div>`;
    })
    .catch(error => {
        console.error('Error:', error);
    });
});
</script>
{% endblock %}
